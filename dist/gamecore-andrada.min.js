/**
 * gamecore.js - Copyright 2012 Playcraft Labs, Inc. (see licence.txt)
 * class.js
 * Classes and objects
 */,l=function(e,t,n){n=n||e;for(var i in e)n[i]=r(e[i])&&r(t[i])&&f.test(e[i])?function(e,n){return function(){var r=this._super,i;return this._super=t[e],i=n.apply(this,arguments),this._super=r,i}}(i,e[i]):e[i]},c=t.Class=function(){if(arguments.length)return c.extend.apply(c,arguments)};o(c,{callback:function(e){var t=i(arguments),n;return e=t.shift(),s(e)||(e=[e]),n=this,function(){var i=a(t,arguments),o,u=e.length,f=0,l;for(;f<u;f++){l=e[f];if(!l)continue;o=typeof l=="string",o&&n._set_called&&(n.called=l),i=(o?n[l]:l).apply(n,i||[]),f<u-1&&(i=!s(i)||i._use_call?[i]:i)}return i}},getObject:t.String.getObject,newInstance:function(){var e=this.rawInstance(),t;e.setup&&(t=e.setup.apply(e,arguments));for(var n in e.__proto__)e[n]=u(e[n]);return e.init&&e.init.apply(e,s(t)?t:arguments),e},setup:function(e,t){return this.defaults=o(!0,{},e.defaults,this.defaults),this._types==undefined&&(this._types=[]),this._types.push(this.fullName),this._fullTypeName==undefined&&(this._fullTypeName="|"),this._fullTypeName+=this.fullName+"|",arguments},rawInstance:function(){n=!0;var e=new this;return n=!1,e},extend:function(t,r,i){function m(){if(n)return;return this.constructor!==m&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}typeof t!="string"&&(i=r,r=t,t=null),i||(i=r,r=null),i=i||{};var s=this,f=this.prototype,h,p,d,v;this.isA=function(e){return this._fullTypeName.indexOf("|"+e+"|")!=-1},n=!0,v=new this,n=!1,l(i,f,v);for(h in this)this.hasOwnProperty(h)&&(m[h]=u(this[h]));l(r,this,m);if(t){var g=t.split(/\./),p=g.pop();g.length>0&&(current=c.getObject(g.join("."),e,!0),d=current),current[p]=m}o(m,{prototype:v,namespace:d,shortName:p,constructor:m,fullName:t}),m.prototype.Class=m.prototype.constructor=m;var y=m.setup.apply(m,a([s],arguments));return m.init&&m.init.apply(m,y||[]),m}}),c.prototype.callback=c.callback}(window),window.gamecore={},gamecore.Class=$.Class,gamecore.Base=gamecore.Class("gamecore.Base",{totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(e,t,n){var r="";e&&(r=":"+e),console.log(this.fullName+r+" ["+t+"] "+n)},warn:function(e){this.log(null,this.WARN,e)},debug:function(e){this.log(null,this.DEBUG,e)},error:function(e){this.log(null,this.ERROR,e)},info:function(e){this.log(null,this.INFO,e)},assert:function(e,t){if(!t)throw e}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++,this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(e){this.Class.log(this.objectId,this.Class.WARN,e)},debug:function(e){this.Class.log(this.objectId,this.Class.DEBUG,e)},error:function(e){this.Class.log(this.objectId,this.Class.ERROR,e)},info:function(e){this.Class.log(this.objectId,this.Class.INFO,e)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}}),gamecore.Device=gamecore.Base.extend("gamecore.Device",{pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1,this.isiPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1,this.isiPhone4=this.pixelRatio==2&&this.isiPhone,this.isiPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1,this.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")!=-1,this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")!=-1,this.isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")!=-1,this.isOpera=navigator.userAgent.toLowerCase().indexOf("opera")!=-1,this.isTouch=window.ontouchstart!=="undefined",window.performance!=undefined&&(this.hasMemoryProfiling=window.performance.memory),/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var e=new Audio;e.canPlayType("audio/ogg")&&(this.canPlayOgg=!0),e.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0),e.canPlayType("audio/x-wav")&&(this.canPlayWav=!0),this.requestAnimFrame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,16,Date.now())};return function(t,n){e.apply(window,[t,n])}}()},canPlay:function(e){return e.toLowerCase()==="mp3"&&this.canPlayMP3?!0:e.toLowerCase()==="ogg"&&this.canPlayOgg?!0:e.toLowerCase()==="wav"&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{}),gamecore.Hashtable=function(){function n(t){var r;if(typeof t=="string")return t;if(typeof t.hashCode==e)return r=t.hashCode(),typeof r=="string"?r:n(r);if(typeof t.toString==e)return t.toString();try{return String(t)}catch(i){return Object.prototype.toString.call(t)}}function r(e,t){return e.equals(t)}function i(t,n){return typeof n.equals==e?n.equals(t):t===n}function s(e){return function(t){if(t===null)throw new Error("null is not a valid "+e);if(typeof t=="undefined")throw new Error(e+" must not be undefined")}}function a(e,t,n,r){this[0]=e,this.entries=[],this.addEntry(t,n),r!==null&&(this.getEqualityFunction=function(){return r})}function h(e){return function(t){var n=this.entries.length,r,i=this.getEqualityFunction(t);while(n--){r=this.entries[n];if(i(t,r[0]))switch(e){case f:return!0;case l:return r;case c:return[n,r[1]]}}return!1}}function p(e){return function(t){var n=t.length;for(var r=0,i=this.entries.length;r<i;++r)t[n+r]=this.entries[r][e]}}function d(e,t){var n=e.length,r;while(n--){r=e[n];if(t===r[0])return n}return null}function v(e,t){var n=e[t];return n&&n instanceof a?n:null}function m(r,i){var s=this,f=[],l={},c=typeof r==e?r:n,h=typeof i==e?i:null;this.put=function(e,t){o(e),u(t);var n=c(e),r,i,s=null;return r=v(l,n),r?(i=r.getEntryForKey(e),i?(s=i[1],i[1]=t):r.addEntry(e,t)):(r=new a(n,e,t,h),f[f.length]=r,l[n]=r),s},this.get=function(e){o(e);var t=c(e),n=v(l,t);if(n){var r=n.getEntryForKey(e);if(r)return r[1]}return null},this.containsKey=function(e){o(e);var t=c(e),n=v(l,t);return n?n.containsKey(e):!1},this.containsValue=function(e){u(e);var t=f.length;while(t--)if(f[t].containsValue(e))return!0;return!1},this.clear=function(){f.length=0,l={}},this.isEmpty=function(){return!f.length};var p=function(e){return function(){var t=[],n=f.length;while(n--)f[n][e](t);return t}};this.keys=p("keys"),this.values=p("values"),this.entries=p("getEntries"),this.remove=function(e){o(e);var n=c(e),r,i=null,s=v(l,n);return s&&(i=s.removeEntryForKey(e),i!==null&&(s.entries.length||(r=d(f,n),t(f,r),delete l[n]))),i},this.size=function(){var e=0,t=f.length;while(t--)e+=f[t].entries.length;return e},this.each=function(e){var t=s.entries(),n=t.length,r;while(n--)r=t[n],e(r[0],r[1])},this.putAll=function(t,n){var r=t.entries(),i,o,u,a,f=r.length,l=typeof n==e;while(f--)i=r[f],o=i[0],u=i[1],l&&(a=s.get(o))&&(u=n(o,a,u)),s.put(o,u)},this.clone=function(){var e=new m(r,i);return e.putAll(s),e},this.toString=function(){var e="",t=this.keys();for(var n=0;n<t.length;n++){var r=this.get(t[n]);e+=t[n].toString()+" = "+r.toString()+"\n"}return e}}var e="function",t=typeof Array.prototype.splice==e?function(e,t){e.splice(t,1)}:function(e,t){var n,r,i;if(t===e.length-1)e.length=t;else{n=e.slice(t+1),e.length=t;for(r=0,i=n.length;r<i;++r)e[t+r]=n[r]}},o=s("key"),u=s("value"),f=0,l=1,c=2;return a.prototype={getEqualityFunction:function(t){return typeof t.equals==e?r:i},getEntryForKey:h(l),getEntryAndIndexForKey:h(c),removeEntryForKey:function(e){var n=this.getEntryAndIndexForKey(e);return n?(t(this.entries,n[0]),n[1]):null},addEntry:function(e,t){this.entries[this.entries.length]=[e,t]},keys:p(0),values:p(1),getEntries:function(e){var t=e.length;for(var n=0,r=this.entries.length;n<r;++n)e[t+n]=this.entries[n].slice(0)},containsKey:h(f),containsValue:function(e){var t=this.entries.length;while(t--)if(e===this.entries[t][1])return!0;return!1}},m}(),gamecore.HashList=gamecore.Base.extend("gamecore.HashList",{},{hashtable:null,init:function(){this.hashtable=new gamecore.Hashtable},add:function(e,t){var n=this.hashtable.get(e);n==null&&(n=new gamecore.LinkedList,this.hashtable.put(e,n)),n.add(t)},remove:function(e,t){var n=this.hashtable.get(e);if(n==null)throw"No list for a key in hashlist when removing";n.remove(t)},get:function(e){return this.hashtable.get(e)}}),gamecore.LinkedListNode=gamecore.Base("gamecore.LinkedNode",{},{obj:null,nextLinked:null,prevLinked:null,free:!0,next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}}),gamecore.LinkedList=gamecore.Base("gamecore.LinkedList",{},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super(),this.objToNodeMap=new gamecore.Hashtable},getNode:function(e){return this.objToNodeMap.get(e.getUniqueId())},addNode:function(e){var t=new gamecore.LinkedNode;return t.obj=e,t.prevLinked=null,t.nextLinked=null,t.free=!1,this.objToNodeMap.put(e.getUniqueId(),t),t},add:function(e){var t=this.getNode(e);if(t==null)t=this.addNode(e);else{if(t.free==0)throw"Attempting to add object: "+e.getUniqueId()+" twice to list "+this.getUniqueId();t.obj=e,t.free=!1,t.nextLinked=null,t.prevLinked=null}if(this.first==null)this.first=t,this.last=t,t.nextLinked=null,t.prevLinked=null;else{if(this.last==null)throw"Hmm, no last in the list -- that shouldn't happen here";this.last.nextLinked=t,t.prevLinked=this.last,this.last=t,t.nextLinked=null}this.count++,this.showDebug&&this.dump("after add")},has:function(e){var t=this.getNode(e);return t!=null&&t.free!=1},moveUp:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.prevLinked==null)return;var n=t.prevLinked,r=n.prevLinked;t==this.last&&(this.last=n);var i=t.nextLinked;r&&(r.nextLinked=t),t.nextLinked=n,t.prevLinked=n.prevLinked,n.nextLinked=i,n.prevLinked=t,this.first==n&&(this.first=t)},moveDown:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.nextLinked==null)return;var n=t.nextLinked;this.moveUp(n.obj),this.last==n&&(this.last=t)},sort:function(e){var t=[],n=this.first;while(n)t.push(n.object()),n=n.next();this.clear(),t.sort(e);for(var r=0;r<t.length;r++)this.add(t[r])},remove:function(e){this.showDebug&&this.dump("before remove of "+e);var t=this.getNode(e);return t==null||t.free==1?!1:(t.prevLinked!=null&&(t.prevLinked.nextLinked=t.nextLinked),t.nextLinked!=null&&(t.nextLinked.prevLinked=t.prevLinked),t.prevLinked==null&&(this.first=t.nextLinked),t.nextLinked==null&&(this.last=t.prevLinked),t.free=!0,t.prevLinked=null,t.nextLinked=null,this.count--,this.showDebug&&this.dump("after remove"),!0)},clear:function(){var e=this.first;while(e!=null)e.free=!0,e=e.nextLinked;this.first=null,this.count=0},length:function(){return this.count},dump:function(e){this.debug("===================="+e+"=====================");var t=this.first;while(t!=null)this.debug("{"+t.obj.toString()+"} previous="+(t.prevLinked?t.prevLinked.obj:"NULL")),t=t.next();this.debug("==================================="),this.debug("Last: {"+(this.last?this.last.obj:"NULL")+"} "+"First: {"+(this.first?this.first.obj:"NULL")+"}")}}),gamecore.Pool=gamecore.Base.extend("gamecore.Pool",{INITIAL_POOL_SIZE:1,pools:new gamecore.Hashtable,totalPooled:0,totalUsed:0,acquire:function(e,t){var n=this.getPool(e);if(n==undefined||n==null)n=new gamecore.Pool(e,this.INITIAL_POOL_SIZE,t),this.pools.put(e.fullName,n);return n.acquire()},release:function(e){var t=this.pools.get(e.Class.fullName);if(t==undefined)throw"Oops, trying to release an object of type "+e.Class.fullName+" but no pool exists. Did you new an object instead of using create.";t.release(e)},getPool:function(e){return this.pools.get(e.fullName)},getStats:function(){var e="",t=this.pools.keys(),n,r;for(var i=0;i<t.length;i++)n=t[i],r=this.pools.get(n),r.dual?e+=n+" (free: "+r.freeList.length()+" used: "+r.usedList.length()+")\n":e+=n+": "+r.getStats()+"\n";return e}},{dual:!1,freeList:null,expansion:1,traces:null,init:function(e,t,n){typeof n=="boolean"&&(this.dual=n),this.classType=e,this.dual?(this.usedList=new gamecore.LinkedList,this.freeList=new gamecore.LinkedList):(this._super(),this.freeList=[]),this.expand(t)},startTracing:function(){if(this.tracing)return;this.tracing=!0,this.traces?this.traces.clear():this.traces=new gamecore.Hashtable},stopTracing:function(){this.tracing=!1},expand:function(e){gamecore.Pool.totalPooled+=e;for(var t=0;t<e;t++)this.dual?this.freeList.add(new this.classType):this.freeList.push(new this.classType)},getFreeCount:function(){return this.freeList.length},returnObj:null,acquire:function(){this.dual?(this.freeList.first==null&&this.expand(Math.round(this.size()/5)+1),this.returnObj=this.freeList.first.obj,this.freeList.remove(this.returnObj),this.returnObj.destroyed=!1,this.usedList.add(this.returnObj)):this.freeList.length<=0&&(this.expansion=Math.round(this.expansion*1.2)+1,this.expand(this.expansion));if(this.tracing){var e=printStackTrace(),t=e.length-1;while(e[t].indexOf("Class.addTo")==0&&t>0)t--;var n=this.traces.get(e[t]);n==null?this.traces.put(e[t],{value:1}):n.value++}return this.dual?this.returnObj:this.freeList.pop()},release:function(e){this.dual?(this.freeList.add(e),this.usedList.remove(e)):this.freeList.push(e)},getStats:function(){var e=this.Class.fullName+" stats: "+this.freeList.length+" free.\n";if(this.tracing){e+="TRACING\n";var t=this.traces.keys();for(var n in t)e+=t[n]+" ("+this.traces.get(t[n]).value+")\n"}return e},dump:function(e){this.info("================== "+e+" ==================="),this.info("FREE"),this.freeList.dump(),this.dual&&(this.info("USED"),this.usedList.dump())},size:function(){return this.dual?this.freeList.count+this.usedList.count:this.freeList.length},getFreeList:function(){return this.freeList},getUsedList:function(){return this.usedList}}),gamecore.Pooled=gamecore.Base("gamecore.Pooled",{create:function(e){return gamecore.Pool.acquire(this,e)},getPool:function(){return gamecore.Pool.getPool(this)}},{destroyed:!1,dual:!1,init:function(e){this._super(),typeof e=="boolean"&&(this.dual=e)},release:function(){this.onRelease(),gamecore.Pool.release(this)},onRelease:function(){}}),gamecore.PerformanceMeasure=gamecore.Base.extend("gamecore.PerformanceMeasure",{history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(e){this.description=e,this.start(),this.Class.history.push(this)},start:function(){this.timeStart=Date.now(),this.memStart=gamecore.Device.getUsedHeap()},end:function(){return this.timeEnd=Date.now(),this.timeDelta=this.timeEnd-this.timeStart,this.memEnd=gamecore.Device.getUsedHeap(),this.memEnd<this.memStart?this.memDelta=0:this.memDelta=this.memEnd-this.memStart,this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(this.memDelta==0?"unknown":this.memDelta)+" byte(s)"}}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(e,t){return e=e||this.createException(),t=t||this.mode(e),t==="other"?this.other(arguments.callee):this[t](e)},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){return e.arguments&&e.stack?"chrome":typeof e.message=="string"&&typeof window!="undefined"&&window.opera?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":e.stack?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":"opera10a":"opera9":e.stack?"firefox":"other"},instrumentFunction:function(e,t,n){e=e||window;var r=e[t];e[t]=function(){return n.call(this,printStackTrace().slice(4)),e[t]._instrumented.apply(this,arguments)},e[t]._instrumented=r},deinstrumentFunction:function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},chrome:function(e){var t=(e.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return t.pop(),t},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(e){var t="{anonymous}",n=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,r=e.stacktrace.split("\n"),i=[];for(var s=0,o=r.length;s<o;s+=2){var u=n.exec(r[s]);if(u){var a=u[4]+":"+u[1]+":"+u[2],f=u[3]||"global code";f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,t),i.push(f+"@"+a+" -- "+r[s+1].replace(/^\s+/,""))}}return i},opera10b:function(e){var t=/^(.*)@(.+):(\d+)$/,n=e.stacktrace.split("\n"),r=[];for(var i=0,s=n.length;i<s;i++){var o=t.exec(n[i]);if(o){var u=o[1]?o[1]+"()":"global code";r.push(u+"@"+o[2]+":"+o[3])}}return r},opera10a:function(e){var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[];for(var s=0,o=r.length;s<o;s+=2){var u=n.exec(r[s]);if(u){var a=u[3]||t;i.push(a+"()@"+u[2]+":"+u[1]+" -- "+r[s+1].replace(/^\s+/,""))}}return i},opera9:function(e){var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[];for(var s=2,o=r.length;s<o;s+=2){var u=n.exec(r[s]);u&&i.push(t+"()@"+u[2]+":"+u[1]+" -- "+r[s+1].replace(/^\s+/,""))}return i},other:function(e){var t="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,r=[],i,s,o=10;while(e&&e.arguments&&r.length<o)i=n.test(e.toString())?RegExp.$1||t:t,s=Array.prototype.slice.call(e.arguments||[]),r[r.length]=i+"("+this.stringifyArguments(s)+")",e=e.caller;return r},stringifyArguments:function(e){var t=[],n=Array.prototype.slice;for(var r=0;r<e.length;++r){var i=e[r];i===undefined?t[r]="undefined":i===null?t[r]="null":i.constructor&&(i.constructor===Array?i.length<3?t[r]="["+this.stringifyArguments(i)+"]":t[r]="["+this.stringifyArguments(n.call(i,0,1))+"..."+this.stringifyArguments(n.call(i,-1))+"]":i.constructor===Object?t[r]="#object":i.constructor===Function?t[r]="#function":i.constructor===String?t[r]='"'+i+'"':i.constructor===Number&&(t[r]=i))}return t.join(",")},sourceCache:{},ajax:function(e){var t=this.createXMLHTTPObject();if(t)try{return t.open("GET",e,!1),t.send(null),t.responseText}catch(n){}return""},createXMLHTTPObject:function(){var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var n=0;n<t.length;n++)try{return e=t[n](),this.createXMLHTTPObject=t[n],e}catch(r){}},isSameDomain:function(e){return typeof location!="undefined"&&e.indexOf(location.hostname)!==-1},getSource:function(e){return e in this.sourceCache||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},guessAnonymousFunctions:function(e){for(var t=0;t<e.length;++t){var n=/\{anonymous\}\(.*\)@(.*)/,r=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,i=e[t],s=n.exec(i);if(s){var o=r.exec(s[1]);if(o){var u=o[1],a=o[2],f=o[3]||0;if(u&&this.isSameDomain(u)&&a){var l=this.guessAnonymousFunction(u,a,f);e[t]=i.replace("{anonymous}",l)}}}}return e},guessAnonymousFunction:function(e,t,n){var r;try{r=this.findFunctionName(this.getSource(e),t)}catch(i){r="getSource failed with url: "+e+", exception: "+i.toString()}return r},findFunctionName:function(e,t){var n=/function\s+([^(]*?)\s*\(([^)]*)\)/,r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,i=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,s="",o,u=Math.min(t,20),a,f;for(var l=0;l<u;++l){o=e[t-l-1],f=o.indexOf("//"),f>=0&&(o=o.substr(0,f));if(o){s=o+s,a=r.exec(s);if(a&&a[1])return a[1];a=n.exec(s);if(a&&a[1])return a[1];a=i.exec(s);if(a&&a[1])return a[1]}}return"(?)"}};
